# 项目提示与协作规则

本文件为在 VS Code 中协作的通用约定，供人类与 GitHub Copilot（代理）共同参考。

## 测试运行（Windows）
不要执行 `PreCompile` 或 `Compile` 任务，这些任务和我的项目业务无关。
- 运行测试：在 `server` 目录下运行语言服务器并加载测试入口：
  - 简单方式：`bin/lua-language-server.exe test.lua`

## 代码修改原则
- 变更应聚焦需求，避免无关重构与大范围格式化。
- 优先修复根因，不做表面绕过；保持与现有风格一致。
- 修改解析/编译逻辑后，尽量补充或更新相应测试用例（位于 `test/`）。
- 若新增语法或节点：
  - AST：置于 `script/parser/ast/cats/`，按现有模块拆分。
  - VM 编译：在 `script/vm/coder/` 注册对应 provider。
  - 运行时节点：在 `script/node/` 增加节点与 `onView` 显示。

## 测试失败排查建议
- 按用例断言文本核对 `viewer:view()` 的输出是否与预期匹配。
- 针对解析层：确认词法消耗与回退逻辑是否正确（例如 `?` 的可选与三元冲突）。
- 针对 VM 层：确认是否为所有新节点生成了代码行并传递到运行时。

## 代理（Copilot）协作约定
- 代理在多步任务中会维护 TODO 计划，并在关键步骤后汇报进度。
- 代理编辑文件使用补丁方式；不会随意重命名文件或更改公开 API。
- 若需要新增规则或流程，请在本文件补充条目，并@说明由谁维护。
